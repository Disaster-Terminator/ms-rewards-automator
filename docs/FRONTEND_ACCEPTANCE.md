# 前端分支验收方案

## 一、验收概述

本项目为 Tauri 2.0 桌面应用，验收流程针对 Tauri 特性进行优化。

### 验收原则

1. **自动化优先** - 除最后一步人工验收外，其余步骤由 Agent 自查自纠
2. **快速失败** - 发现问题立即停止，不浪费时间
3. **分层验收** - 从代码质量到功能完整性逐层验证
4. **可重复执行** - 验收脚本可多次运行

---

## 二、验收流程

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    前端自动化验收 (阶段1-5)                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  阶段1: 依赖检查 ──→ 阶段2: 类型检查 ──→ 阶段3: Rust 编译                 │
│                              ↓                                          │
│         阶段4: 后端 API 验证 (失败立即停止)                               │
│                              ↓ 通过                                     │
│         阶段5: Tauri 开发模式验证                                        │
│                              ↓ 通过                                     │
└─────────────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────────────┐
│              阶段6: Tauri 应用人工验收 (必须人工)                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 三、验收阶段详解

### 阶段1: 依赖检查

**目的**: 确保所有依赖正确安装

**验收命令**:
```bash
# 检查 Python 依赖
pip install -r requirements.txt
python -c "import fastapi, uvicorn, websockets; print('Python dependencies OK')"

# 检查 Node.js 依赖
cd frontend
npm install
npm ls --depth=0

# 检查 Rust 环境
rustc --version
cargo --version
```

**通过条件**:
- [ ] Python 依赖无缺失
- [ ] Node.js 依赖无缺失
- [ ] Rust 编译器可用

**失败处理**: 安装缺失依赖

---

### 阶段2: 类型检查

**目的**: 确保 TypeScript 类型安全

**验收命令**:
```bash
cd frontend
npx tsc --noEmit
```

**通过条件**:
- [ ] TypeScript 编译无错误
- [ ] 无隐式 any 类型警告
- [ ] 无未使用变量警告

**失败处理**: 修复类型错误

---

### 阶段3: Rust 编译

**目的**: 确保 Tauri 后端编译正确

**验收命令**:
```bash
cd frontend/src-tauri
cargo check
```

**通过条件**:
- [ ] Rust 编译无错误
- [ ] 无编译警告

**失败处理**: 检查编译日志，修复问题

---

### 阶段4: 后端 API 验证

**目的**: 确保后端 API 服务正常

**验收命令**:
```bash
# 启动后端服务 (后台运行)
python web_server.py --host 127.0.0.1 --port 8000 &
SERVER_PID=$!
sleep 5

# 测试 API 端点
curl -s http://127.0.0.1:8000/api/health
curl -s http://127.0.0.1:8000/api/status
curl -s http://127.0.0.1:8000/api/config

# 停止服务
kill $SERVER_PID
```

**通过条件**:
- [ ] 服务器启动成功
- [ ] /api/health 返回有效 JSON
- [ ] /api/status 返回有效 JSON
- [ ] /api/config 返回有效 JSON

**失败处理**: 检查服务器日志，修复 API 问题

---

### 阶段5: Tauri 开发模式验证

**目的**: 验证 Tauri 应用可正常启动

**验收命令**:
```bash
# 1. 启动 Python 后端
python web_server.py --host 127.0.0.1 --port 8000 &

# 2. 启动 Tauri 开发模式 (在另一个终端)
cd frontend
npm run tauri:dev
```

**通过条件**:
- [ ] Tauri 窗口正常打开
- [ ] 前端页面正常渲染
- [ ] 无 JavaScript 控制台错误
- [ ] API 请求正常响应

**失败处理**: 检查 Tauri 控制台日志

---

### 阶段6: Tauri 应用人工验收 (必须)

**目的**: 人工确认 UI 交互和视觉效果

**验收命令**:
```bash
# 启动 Python 后端
python web_server.py --host 127.0.0.1 --port 8000

# 启动 Tauri 开发模式
cd frontend && npm run tauri:dev
```

**验收检查项**:

#### 6.1 窗口效果
- [ ] 窗口正常显示
- [ ] Mica 毛玻璃效果生效 (Windows 11)
- [ ] 窗口可拖拽 (Header 区域)
- [ ] 窗口可最小化/最大化/关闭

#### 6.2 仪表盘页面
- [ ] 积分信息正确显示
- [ ] 搜索进度条正确显示（默认桌面30次、移动20次）
- [ ] 任务提示区域正确显示
- [ ] 运行时间和健康状态正确显示
- [ ] 后端状态指示器正常

#### 6.3 任务控制页面
- [ ] 执行模式选择正常
- [ ] 选项开关正常工作 (Toggle 对齐正确)
- [ ] 启动按钮响应正常
- [ ] 停止按钮响应正常
- [ ] 实时进度和积分变化正确显示

#### 6.4 配置管理页面
- [ ] 各配置项正确显示
- [ ] 保存配置功能正常
- [ ] Toast 通知显示正常
- [ ] 表单验证正常

#### 6.5 日志查看页面
- [ ] 日志正确显示
- [ ] 过滤功能正常
- [ ] 搜索功能正常

#### 6.6 历史记录页面
- [ ] 历史列表正确显示
- [ ] 图表正确渲染

#### 6.7 主题切换功能
- [ ] 主题切换按钮正常工作
- [ ] 暗色模式样式正确
- [ ] 亮色模式样式正确
- [ ] 所有页面主题切换一致

#### 6.8 WebSocket 连接
- [ ] 实时状态更新正常
- [ ] 无连接断开警告

**验收签字**:
```
验收人: ____________    日期: ____________
备注: _______________________________________________
```

---

## 四、验收命令汇总

```bash
# 完整自动化验收 (阶段1-4)
cd frontend && npm install && npx tsc --noEmit
cd src-tauri && cargo check

# 启动后端
python web_server.py --host 127.0.0.1 --port 8000

# 启动 Tauri 开发模式
cd frontend && npm run tauri:dev

# 构建生产版本
cd frontend && npm run tauri:build
```

---

## 五、常见问题

### Q: Tauri 编译失败?

1. 确保已安装 Rust: `rustc --version`
2. 清理缓存: `cd src-tauri && cargo clean`
3. 重新编译: `cargo check`

### Q: 开发模式下前端无法连接后端?

确保 Python 后端在 `localhost:8000` 运行。开发模式下 Tauri 不启动 Sidecar。

### Q: Toggle 开关指示器不对齐?

确保使用 `flex items-center` 居中，而非 `mt-1` margin 方式。

### Q: Mica 效果不生效?

1. 确保运行在 Windows 11
2. 检查 `tauri.conf.json` 中 `transparent: true` 和 `windowEffects` 配置

---

## 六、注意事项

1. **验收顺序** - 必须按阶段顺序执行，不可跳过
2. **失败处理** - 任何阶段失败立即停止，修复后重新开始
3. **环境要求** - 需要 Python 3.10+、Node.js 18+、Rust 1.70+
4. **端口占用** - 确保 8000 端口未被占用
5. **人工验收** - 阶段6必须由开发者亲自执行

---

## 相关文档

- [Tauri 架构文档](./TAURI_ARCHITECTURE.md)
- [前端开发指南](./WEB_FRONTEND_GUIDE.md)
- [用户指南](./guides/用户指南.md)
