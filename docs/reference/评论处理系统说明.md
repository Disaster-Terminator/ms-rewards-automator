# è¯„è®ºå¤„ç†ç³»ç»Ÿè¯´æ˜

> æœ€åæ›´æ–°: 2026-02-24

## æ¦‚è¿°

è¯„è®ºå¤„ç†ç³»ç»Ÿç”¨äºè·å–å’Œå¤„ç† AI å®¡æŸ¥å·¥å…·ï¼ˆSourcery/Qodo/Copilotï¼‰çš„è¯„è®ºï¼Œæä¾›ç»Ÿä¸€çš„ CLI æ¥å£å’Œç»“æ„åŒ–æ•°æ®å­˜å‚¨ã€‚

## æ¶æ„

### æ ¸å¿ƒåŸåˆ™

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| **Single Source of Truth** | GitHub Thread æ˜¯æ ¸å¿ƒæ“ä½œå¯¹è±¡ |
| **API First, DB Second** | å…ˆè°ƒç”¨ GitHub APIï¼ŒæˆåŠŸåæ›´æ–°æœ¬åœ°æ•°æ®åº“ |
| **Thread ä¸ºä¸»ï¼ŒOverview ä¸ºè¾…** | Thread æ˜¯æ“ä½œå¯¹è±¡ï¼ŒOverview æ˜¯åªè¯»å‚è€ƒ |

### æ•°æ®æµ

```
GitHub API â†’ GraphQL Client â†’ Resolver â†’ Manager â†’ TinyDB
                â†“
         ReviewThreadState (Thread + enriched_context)
         ReviewOverview (åªè¯»å‚è€ƒ)
         IssueCommentOverview (åªè¯»å‚è€ƒ)
```

### æ¨¡å—ç»“æ„

```
src/review/
â”œâ”€â”€ models.py           # æ•°æ®æ¨¡å‹å®šä¹‰
â”œâ”€â”€ parsers.py          # è¯„è®ºè§£æå™¨
â”œâ”€â”€ graphql_client.py   # GitHub GraphQL API å®¢æˆ·ç«¯
â”œâ”€â”€ resolver.py         # è¯„è®ºè§£å†³å™¨ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
â””â”€â”€ comment_manager.py  # æ•°æ®æŒä¹…åŒ–ç®¡ç†å™¨
```

## æ•°æ®æ¨¡å‹

### ReviewThreadStateï¼ˆæ ¸å¿ƒæ“ä½œå¯¹è±¡ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | str | Thread IDï¼ˆç”¨äºè§£å†³æ“ä½œï¼‰ |
| `source` | str | æ¥æºï¼šSourcery / Qodo / Copilot |
| `local_status` | str | çŠ¶æ€ï¼špending / resolved / ignored |
| `is_resolved` | bool | GitHub ä¸Šçš„è§£å†³çŠ¶æ€ï¼ˆåªè¯»ï¼‰ |
| `file_path` | str | æ–‡ä»¶è·¯å¾„ |
| `line_number` | int \| None | è¡Œå·ï¼ŒNone è¡¨ç¤ºæ–‡ä»¶çº§è¯„è®º |
| `primary_comment_body` | str | è¯„è®ºå†…å®¹ |
| `enriched_context` | EnrichedContext | ç»“æ„åŒ–å…ƒæ•°æ®ï¼ˆå¯é€‰ï¼‰ |
| `resolution_type` | str | è§£å†³ä¾æ®ç±»å‹ |

### EnrichedContext

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `issue_type` | str | é—®é¢˜ç±»å‹ï¼ˆBug / Security / suggestion ç­‰ï¼‰ |
| `issue_to_address` | str | é—®é¢˜æè¿°ï¼ˆæ¥è‡ª Sourcery Promptï¼‰ |
| `code_context` | str | ä»£ç ä¸Šä¸‹æ–‡ï¼ˆæ¥è‡ª Sourcery Promptï¼‰ |

### ReviewOverviewï¼ˆåªè¯»å‚è€ƒï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | str | Review ID |
| `source` | str | æ¥æº |
| `high_level_feedback` | list | é«˜å±‚å»ºè®® |
| `has_prompt_for_ai` | bool | æ˜¯å¦åŒ…å« Prompt for AI Agents |
| `prompt_overall_comments` | list | Overall Comments |

### IssueCommentOverviewï¼ˆåªè¯»å‚è€ƒï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | str | Issue Comment ID |
| `source` | str | æ¥æºï¼ˆQodoï¼‰ |
| `is_pr_reviewer_guide` | bool | æ˜¯å¦ä¸º PR Reviewer Guide |
| `is_code_change_summary` | bool | æ˜¯å¦ä¸ºä»£ç å˜åŒ–æ‘˜è¦ |

## CLI å‘½ä»¤

### è·å–è¯„è®º

```bash
python tools/manage_reviews.py fetch --owner OWNER --repo REPO --pr PR_NUMBER
```

è¾“å‡ºç¤ºä¾‹ï¼š

```json
{
  "success": true,
  "message": "è·å–äº† 14 ä¸ªçº¿ç¨‹, 6 ä¸ªæ€»è§ˆæ„è§, 2 ä¸ª Issue Comments",
  "threads_count": 14,
  "overviews_count": 6,
  "issue_comments_count": 2
}
```

### åˆ—å‡ºè¯„è®º

```bash
# è¡¨æ ¼æ ¼å¼ï¼ˆé»˜è®¤ï¼‰
python tools/manage_reviews.py list --status pending

# JSON æ ¼å¼
python tools/manage_reviews.py list --status pending --format json

# æŒ‰æ¥æºè¿‡æ»¤
python tools/manage_reviews.py list --source Qodo
```

è¡¨æ ¼è¾“å‡ºç¤ºä¾‹ï¼š

```
                                      å¾…å¤„ç†è¯„è®º (6)                                      
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ ID           â”ƒ Source     â”ƒ Status     â”ƒ Enriched     â”ƒ Location                       â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ PRRT_kwD...  â”‚ Qodo       â”‚ pending    â”‚ âœ… Bug       â”‚ requirements.txt:1             â”‚  â† çº¢è‰²
â”‚ PRRT_kwD...  â”‚ Sourcery   â”‚ pending    â”‚ âœ… Sug       â”‚ pyproject.toml:21              â”‚  â† é»„è‰²
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŸ¥çœ‹æ€»è§ˆæ„è§

```bash
python tools/manage_reviews.py overviews
```

### æŸ¥çœ‹ç»Ÿè®¡

```bash
python tools/manage_reviews.py stats
```

### è§£å†³è¯„è®º

```bash
python tools/manage_reviews.py resolve --thread-id THREAD_ID --type RESOLUTION_TYPE [--reply "å›å¤å†…å®¹"]
```

è§£å†³ä¾æ®ç±»å‹ï¼š

| ç±»å‹ | è¯´æ˜ | éœ€è¦å›å¤ |
|------|------|----------|
| `code_fixed` | ä»£ç å·²ä¿®å¤ | å¦ |
| `adopted` | å·²é‡‡çº³å»ºè®® | å¦ |
| `rejected` | æ‹’ç»å»ºè®® | æ˜¯ |
| `false_positive` | è¯¯æŠ¥ | æ˜¯ |
| `outdated` | è¿‡æ—¶ | å¦ |

## ä¸šåŠ¡è§„åˆ™

### é—®é¢˜åˆ†ç±»

| åˆ†ç±» | ç±»å‹ | é¢œè‰² | è¡Œä¸º |
|------|------|------|------|
| **å¿…é¡»ä¿®å¤** | Bug, Security, Rule violation, Reliability | çº¢è‰² | æŠ¥å‘Šç”¨æˆ·ï¼Œç­‰å¾…ä¿®å¤æŒ‡ä»¤ |
| **è‡ªä¸»å†³æ–­** | suggestion, Correctness, performance | é»„è‰² | æŠ¥å‘Šç”¨æˆ·ï¼Œè‡ªä¸»å†³æ–­ |

### ä¸‰ç§ AI å®¡æŸ¥å·¥å…·

| å·¥å…· | GitHub ç”¨æˆ·å | ç‰¹ç‚¹ |
|------|--------------|------|
| **Sourcery** | `sourcery-ai bot` | ç»“æ„åŒ–æ‘˜è¦ï¼ˆPrompt for AI Agentsï¼‰ï¼ŒåŠ¨æ€è§£å†³çŠ¶æ€ |
| **Qodo** | `qodo-code-review bot` | PR Reviewer Guideï¼ˆIssue Commentï¼‰ï¼Œæ— æ³•é€šè¿‡ @ è§£å†³ |
| **Copilot** | `Copilot AI` | ç®€å•è¯„è®ºï¼Œæ— ç»“æ„åŒ–æ‘˜è¦ |

### Sourcery åŠ¨æ€è§£å†³çŠ¶æ€

**é‡è¦è§„å¾‹**ï¼šSourcery ä¼šæ ¹æ®æ–°æ¨é€çš„ commit è‡ªåŠ¨æ£€æµ‹å¹¶æ›´æ–°è¯„è®ºçŠ¶æ€ï¼š

- å½“ä»£ç ä¿®æ”¹è§£å†³äº†æŸä¸ªè¯„è®ºæ—¶ï¼ŒSourcery ä¼šè‡ªåŠ¨æ ‡è®°ä¸º `âœ… Addressed in {commit_hash}`
- è¿™æ„å‘³ç€å¾…å¤„ç†è¯„è®ºæ•°é‡ä¼šéš commit åŠ¨æ€å˜åŒ–
- è·å–è¯„è®ºå‰åº”ç¡®ä¿æ•°æ®æ˜¯æœ€æ–°çš„ï¼ˆé‡æ–° fetchï¼‰

### å…³é”®åŒºåˆ†

| äº§ç‰© | ç±»å‹ | æ˜¯å¦æ”¹è¿›æ„è§ |
|------|------|-------------|
| Sourcery "Reviewer's Guide" | ä»£ç å˜åŒ–æ‘˜è¦ | âŒ ä¸éœ€è¦å¤„ç† |
| Sourcery "Prompt for AI Agents" | å®¡æŸ¥æ‘˜è¦ | âœ… éœ€è¦å¤„ç† |
| Qodo "Review Summary by Qodo" | ä»£ç å˜åŒ–æ‘˜è¦ | âŒ ä¸éœ€è¦å¤„ç† |
| Qodo "PR Reviewer Guide ğŸ”" | æ”¹è¿›æ„è§æ‘˜è¦ | âœ… éœ€è¦å¤„ç† |

## æ•°æ®å­˜å‚¨

### å­˜å‚¨ä½ç½®

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `.trae/data/review_threads.json` | TinyDB æ•°æ®åº“ |
| `.trae/data/review_threads.lock` | å¹¶å‘é” |

### æ•°æ®ç»“æ„

```
review_threads.json
â”œâ”€â”€ metadata è¡¨ï¼ˆå•æ¡è®°å½•ï¼‰
â”‚   â”œâ”€â”€ pr_number
â”‚   â”œâ”€â”€ owner
â”‚   â””â”€â”€ repo
â”œâ”€â”€ threads è¡¨
â”‚   â””â”€â”€ ReviewThreadState[]
â”œâ”€â”€ overviews è¡¨
â”‚   â””â”€â”€ ReviewOverview[]
â””â”€â”€ issue_comment_overviews è¡¨
    â””â”€â”€ IssueCommentOverview[]
```

### æ³¨æ„äº‹é¡¹

- æ¯æ¬¡è·å–æ–° PR ä¼šè¦†ç›– metadata
- threads è¡¨ä¼šåˆå¹¶ï¼ˆå·²å­˜åœ¨çš„æ›´æ–°ï¼Œæ–°å¢çš„æ’å…¥ï¼‰
- åˆ‡æ¢ PR æ—¶ï¼Œä¹‹å‰çš„æ•°æ®ä¼šè¢«æ–° PR æ•°æ®è¦†ç›–

## é™çº§ç­–ç•¥

å¦‚æœ CLI å·¥å…·å¤±è´¥ï¼Œå‚è€ƒ `docs/reference/archive/v1-ai-reviewer-guide.md` ä½¿ç”¨ Playwright æ‰‹åŠ¨è·å–è¯„è®ºã€‚

è¯¥æ–‡æ¡£åŒ…å«ä¸‰ç§æœºå™¨äººçš„å®¡æŸ¥è¯„è®ºæ ¼å¼å’Œè§„å¾‹ã€‚

## ä¸¥ç¦äº‹é¡¹

1. **ä¸¥ç¦ä¸€æ¬¡æ€§è§£å†³æ‰€æœ‰è¯„è®º**ï¼šæ¯ä¸ªè¯„è®ºå¿…é¡»å•ç‹¬å¤„ç†
2. **ä¸¥ç¦æ— ä¾æ®æ ‡è®°è§£å†³**ï¼šå¿…é¡»å…ˆç¡®è®¤é—®é¢˜å·²è§£å†³
3. **ä¸¥ç¦æ‰¹é‡æ“ä½œ**ï¼šå¿…é¡»é€ä¸ªè¯„è®ºå¤„ç†
4. **ä¸¥ç¦è·³è¿‡è¯´æ˜è¯„è®º**ï¼šrejected/false_positive å¿…é¡»å›å¤

## ç›¸å…³æ–‡æ¡£

- [å®¡æŸ¥è¯„è®ºå¤„ç†å·¥ä½œæµæŒ‡å—](å®¡æŸ¥è¯„è®ºå¤„ç†å·¥ä½œæµæŒ‡å—.md)
- [AI å®¡æŸ¥å·¥å…·å‚è€ƒæŒ‡å—ï¼ˆå½’æ¡£ï¼‰](archive/v1-ai-reviewer-guide.md)
- [fetch-reviews Skill](../../.trae/skills/fetch-reviews/SKILL.md)
