# MS-Rewards-Automator 用户指南

## 快速开始

```bash
# 1. 安装环境
git clone https://github.com/Disaster-Terminator/ms-rewards-automator.git
cd ms-rewards-automator
conda env create -f environment.yml
conda activate ms-rewards-bot
playwright install chromium

# 2. 配置
cp config.example.yaml config.yaml
# 编辑 config.yaml，填写账号信息

# 3. 运行
python main.py
```

首次运行时浏览器会打开，手动登录后自动保存会话。

## 命令行参数

### 常用参数

| 参数 | 说明 |
|------|------|
| `python main.py` | 标准运行（30+20搜索，自动调度） |
| `--headless` | 后台运行（不显示浏览器） |
| `--user` | 用户模式（3+3搜索，验证稳定性） |
| `--dev` | 开发模式（2+2搜索，快速调试） |
| `--browser {chromium,edge,chrome}` | 浏览器类型 |

### 执行模式对比

| 参数 | 搜索次数 | 拟人行为 | 调度器 | 用途 |
|------|----------|----------|--------|------|
| 默认 | 30+20 | ✅ | ✅ 启用 | 日常使用 |
| `--user` | 3+3 | ✅ | ❌ 禁用 | 稳定性测试 |
| `--dev` | 2+2 | ❌ | ❌ 禁用 | 快速调试 |

## 配置文件

编辑 `config.yaml`：

```yaml
search:
  desktop_count: 30
  mobile_count: 20
  wait_interval:
    min: 5
    max: 15

browser:
  headless: false

scheduler:
  enabled: true
  timezone: "Asia/Shanghai"
  scheduled_hour: 17
  max_offset_minutes: 45

notification:
  enabled: true
  telegram:
    bot_token: "你的Bot Token"
    chat_id: "你的Chat ID"
```

### 调度器配置

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `enabled` | `true` | 是否启用调度器 |
| `scheduled_hour` | `17` | 基准执行时间（北京时间） |
| `max_offset_minutes` | `45` | 随机偏移范围 |

**禁用调度器**：设置 `scheduler.enabled: false`，程序执行一次后退出。

详细配置说明参见 [配置参考](../reference/CONFIG.md) 和 [调度器文档](../reference/SCHEDULER.md)。

## 故障排除

### 常见问题

| 问题 | 解决方案 |
|------|----------|
| 无法连接Microsoft服务 | 检查网络，WSL2用户建议在Windows运行 |
| 登录超时 | 增加 `timeout_seconds` 到 600 |
| 积分未增加 | 检查是否已达每日上限，查看日志 |
| TOTP验证失败 | 检查密钥正确性，同步系统时间 |
| 浏览器启动失败 | 运行 `playwright install chromium` |

### 日志位置

- 日志文件：`logs/automator.log`
- 调试模式：`python main.py --dev`

## 安全建议

1. **保护配置文件**：`config.yaml` 包含敏感信息，已在 `.gitignore` 中
2. **不要提交敏感信息**：确保不要将 `config.yaml` 提交到版本控制
3. **定期更换密码**
