# MS-Rewards-Automator 用户指南

## 快速开始

```bash
# 1. 安装环境
git clone https://github.com/Disaster-Terminator/ms-rewards-automator.git
cd ms-rewards-automator
conda env create -f environment.yml
conda activate ms-rewards-bot
playwright install chromium

# 2. 配置
cp config.example.yaml config.yaml
# 编辑 config.yaml，填写账号信息

# 3. 运行
python main.py
```

首次运行时浏览器会打开，手动登录后自动保存会话。

## 命令行参数

### 常用参数

| 参数 | 说明 |
|------|------|
| `python main.py` | 标准运行（30+20搜索） |
| `--headless` | 后台运行（不显示浏览器） |
| `--mode fast/slow` | 快速/慢速模式 |
| `--schedule` | 启用定时调度 |
| `--desktop-only` | 仅桌面搜索 |
| `--mobile-only` | 仅移动搜索 |

### 执行模式

| 参数 | 搜索次数 | 拟人行为 | 用途 |
|------|----------|----------|------|
| 默认 | 30+20 | ✅ | 日常使用 |
| `--usermode` | 3+3 | ✅ | 稳定性测试 |
| `--dev` | 2+2 | ❌ | 快速调试 |

### 调度参数

| 参数 | 说明 |
|------|------|
| `--schedule` | 进入调度模式 |
| `--schedule --schedule-now` | 立即执行一次后进入调度 |
| `--no-schedule` | 仅执行一次，不进入调度 |

### 完整参数列表

| 参数 | 说明 |
|------|------|
| `--mode {normal,fast,slow}` | 执行模式 |
| `--dev` | 开发模式 |
| `--usermode` | 用户测试模式 |
| `--headless` | 无头模式 |
| `--browser {chromium,edge,chrome}` | 浏览器类型 |
| `--desktop-only` | 仅桌面搜索 |
| `--mobile-only` | 仅移动搜索 |
| `--skip-daily-tasks` | 跳过每日任务 |
| `--dry-run` | 模拟运行 |
| `--schedule` | 启用调度 |
| `--schedule-now` | 立即执行后调度 |
| `--no-schedule` | 禁用调度 |
| `--schedule-only` | 仅调度模式 |
| `--config FILE` | 配置文件路径 |
| `--test-notification` | 测试通知 |
| `--autonomous-test` | 自主测试 |
| `--test-type {login,bing_access,search,points,full}` | 测试类型 |
| `--quick-test` | 快速测试 |

## 配置文件

编辑 `config.yaml`：

```yaml
search:
  desktop_count: 30
  mobile_count: 20
  wait_interval:
    min: 5
    max: 15

browser:
  headless: false

login:
  auto_login:
    enabled: false
    email: "your-email@example.com"
    password: "your-password"
    totp_secret: "JBSWY3DPEHPK3PXP"  # 2FA密钥

scheduler:
  enabled: true
  timezone: "Asia/Shanghai"
  mode: "scheduled"
  scheduled_hour: 10
  max_offset_minutes: 30

notification:
  enabled: true
  telegram:
    bot_token: "你的Bot Token"
    chat_id: "你的Chat ID"
```

详细配置说明参见 [调度器文档](../reference/SCHEDULER.md) 和 [技术参考](../reports/技术参考.md)。

## 故障排除

### 常见问题

| 问题 | 解决方案 |
|------|----------|
| 无法连接Microsoft服务 | 检查网络，WSL2用户建议在Windows运行 |
| 登录超时 | 增加 `timeout_seconds` 到 600 |
| 积分未增加 | 检查是否已达每日上限，查看日志 |
| TOTP验证失败 | 检查密钥正确性，同步系统时间 |
| 浏览器启动失败 | 运行 `playwright install chromium` |

### 日志位置

- 日志文件：`logs/automator.log`
- 调试模式：`python main.py --dev`

## 安全建议

1. **保护配置文件**：`config.yaml` 包含敏感信息，已在 `.gitignore` 中
2. **不要提交敏感信息**：确保不要将 `config.yaml` 提交到版本控制
3. **定期更换密码**

## 最佳实践

- 使用慢速模式：`python main.py --mode slow`
- 启用调度器随机时间运行
- 不要短时间内多次运行
- 定期检查账号状态
