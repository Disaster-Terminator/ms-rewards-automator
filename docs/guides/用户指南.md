# MS-Rewards-Automator 用户指南

## 快速开始

### 环境准备

```bash
git clone https://github.com/Disaster-Terminator/ms-rewards-automator.git
cd ms-rewards-automator
conda env create -f environment.yml
conda activate ms-rewards-bot
playwright install chromium
```

### 首次运行

```bash
# 复制配置文件
cp config.example.yaml config.yaml
# 编辑 config.yaml，填写账号信息

# 运行
python main.py
```

**登录方式**：

- **手动登录**（推荐）：首次运行时浏览器打开，手动登录后保存会话
- **自动登录**：在 `config.yaml` 的 `auto_login` 部分填写账号密码和 2FA 密钥

## 基本命令

```bash
python main.py                    # 标准运行
python main.py --headless         # 无头模式（后台）
python main.py --mode fast        # 快速模式
python main.py --desktop-only     # 仅桌面搜索
python main.py --mobile-only      # 仅移动搜索
python main.py --schedule         # 调度模式
```

## 核心配置

编辑 `config.yaml`：

```yaml
search:
  desktop_count: 30
  mobile_count: 20
  wait_interval: { min: 5, max: 15 }

browser:
  headless: false
  slow_mo: 100

login:
  state_machine_enabled: true
  timeout_seconds: 300

task_system:
  enabled: true

notification:
  enabled: false
```

## 登录配置

### 自动登录

```yaml
login:
  auto_login:
    enabled: true
    email: "your-email@example.com"
    password: "your-password"
    totp_secret: "JBSWY3DPEHPK3PXP"  # 2FA 密钥
```

获取TOTP密钥：在Microsoft账户安全设置中启用2FA → 选择"使用身份验证器应用" → 点击"无法扫描？" → 复制显示的密钥。

## 任务系统

```yaml
task_system:
  enabled: true
  min_delay: 2
  max_delay: 5
  skip_completed: true
```

支持的任务类型：

- **URL Reward**: 访问链接获取积分
- **Quiz**: 问答任务（随机选择答案）
- **Poll**: 投票任务

## 查询引擎

```yaml
query_engine:
  enabled: true
  sources:
    local_file:
      enabled: true
    bing_suggestions:
      enabled: true
```

## 通知配置

### Telegram

```yaml
notification:
  enabled: true
  telegram:
    enabled: true
    bot_token: "你的Bot Token"
    chat_id: "你的Chat ID"
```

获取方式：@BotFather 创建机器人获取token，@userinfobot 获取Chat ID。

### Server酱（微信推送）

```yaml
notification:
  serverchan:
    enabled: true
    key: "你的SendKey"
```

获取方式：访问 <https://sct.ftqq.com/> 微信扫码登录。

## 故障排除

### 常见问题

| 问题 | 解决方案 |
|------|----------|
| 无法连接Microsoft服务 | 检查网络，WSL2用户建议在Windows运行 |
| 登录超时 | 增加 `timeout_seconds` 到 600 |
| 积分未增加 | 检查是否已达每日上限，查看日志 |
| TOTP验证失败 | 检查密钥正确性，同步系统时间 |
| 浏览器启动失败 | 运行 `playwright install chromium` |

### 日志位置

- 日志文件：`logs/automator.log`
- 调试模式：`python main.py --dev`

## 安全建议

1. **保护配置文件**：`config.yaml` 包含敏感信息，已在 `.gitignore` 中
2. **不要提交敏感信息**：确保不要将 `config.yaml` 提交到版本控制
3. **定期更换密码**

## 最佳实践

- 使用慢速模式：`python main.py --mode slow`
- 启用调度器随机时间运行
- 不要短时间内多次运行
- 定期检查账号状态
