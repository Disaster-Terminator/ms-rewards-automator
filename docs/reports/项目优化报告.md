# MS-Rewards-Automator é¡¹ç›®ä¼˜åŒ–æŠ¥å‘Š

> æ‰«ææ—¶é—´: 2026-02-14
> æ‰«æèŒƒå›´: å…¨é¡¹ç›®ä»£ç ã€é…ç½®ã€æ¶æ„
> æ›´æ–°æ—¶é—´: 2026-02-14 (å·²æ‰§è¡Œä¼˜åŒ–)

---

## ä¸€ã€é¡¹ç›®æ¦‚è§ˆ

### 1.1 é¡¹ç›®ç»“æ„

```
MS-Rewards-Automator/
â”œâ”€â”€ src/                    # ä¸»æºç ç›®å½•
â”‚   â”œâ”€â”€ account/           # è´¦æˆ·ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ browser/           # æµè§ˆå™¨æ¨¡æ‹Ÿæ¨¡å—
â”‚   â”œâ”€â”€ infrastructure/    # åŸºç¡€è®¾æ–½æ¨¡å—
â”‚   â”œâ”€â”€ login/             # ç™»å½•å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ search/            # æœç´¢å¼•æ“æ¨¡å—
â”‚   â”œâ”€â”€ tasks/             # ä»»åŠ¡ç³»ç»Ÿæ¨¡å—
â”‚   â””â”€â”€ ui/                # ç”¨æˆ·ç•Œé¢æ¨¡å—
â”œâ”€â”€ tests/                 # æµ‹è¯•ç›®å½•
â”œâ”€â”€ tools/                 # å·¥å…·è„šæœ¬
â”œâ”€â”€ docs/                  # æ–‡æ¡£ç›®å½•
â””â”€â”€ scripts/               # å¯åŠ¨è„šæœ¬
```

### 1.2 æŠ€æœ¯æ ˆ

- **Python**: å¼‚æ­¥ç¼–ç¨‹ (asyncio)
- **Playwright**: æµè§ˆå™¨è‡ªåŠ¨åŒ–
- **YAML**: é…ç½®ç®¡ç†
- **pytest**: æµ‹è¯•æ¡†æ¶

---

## äºŒã€å·²å®Œæˆçš„ä¼˜åŒ–

### âœ… P0-2: åˆ é™¤å†—ä½™å¤‡ä»½ç›®å½•

**çŠ¶æ€**: å·²å®Œæˆ

**æ‰§è¡Œæ“ä½œ**:

- åˆ é™¤ `src_backup/` ç›®å½• (çº¦ 50+ ä¸ª Python æ–‡ä»¶)
- åˆ é™¤ `tests/tests_backup/` ç›®å½• (çº¦ 20+ ä¸ªæµ‹è¯•æ–‡ä»¶)
- åˆ é™¤ `tools/tools_backup/` ç›®å½• (3 ä¸ªå·¥å…·è„šæœ¬)

**æ•ˆæœ**:

- å‡å°‘é¡¹ç›®ä½“ç§¯
- æ¶ˆé™¤ç»´æŠ¤æ··ä¹±
- é¿å…å¯¼å…¥é”™è¯¯

---

### âœ… P1-1: ä¿®å¤é…ç½®éªŒè¯é€»è¾‘

**çŠ¶æ€**: å·²å®Œæˆ

**ä½ç½®**: `src/infrastructure/config_manager.py`

**ä¿®æ”¹å†…å®¹**:

- `_validate_config_basic()` æ–¹æ³•ç°åœ¨æ”¯æŒ `wait_interval` çš„ä¸¤ç§æ ¼å¼ï¼š
  - å•ä¸ªæ•°å€¼: `wait_interval: 5`
  - å­—å…¸æ ¼å¼: `wait_interval: {min: 3, max: 8}`

**ä¿®æ”¹å‰**:

```python
required_keys = [
    "search.wait_interval.min",  # åªæ”¯æŒå­—å…¸æ ¼å¼
    "search.wait_interval.max",
]
```

**ä¿®æ”¹å**:

```python
# éªŒè¯ wait_intervalï¼ˆæ”¯æŒå•ä¸ªå€¼å’Œå­—å…¸ä¸¤ç§æ ¼å¼ï¼‰
wait_interval = self.get("search.wait_interval")
if isinstance(wait_interval, dict):
    # éªŒè¯ min/max
elif isinstance(wait_interval, (int, float)):
    # éªŒè¯å•ä¸ªå€¼
```

---

### âœ… P1-4: ä¼˜åŒ–ç™»å½•çŠ¶æ€æœºå†å²è®°å½•å†…å­˜ç®¡ç†

**çŠ¶æ€**: å·²å®Œæˆ

**ä½ç½®**: `src/login/login_state_machine.py`

**ä¿®æ”¹å†…å®¹**:

- ä½¿ç”¨ `collections.deque` æ›¿ä»£ `list` å­˜å‚¨çŠ¶æ€å†å²
- è®¾ç½®å›ºå®šæœ€å¤§å®¹é‡ 50 æ¡è®°å½•
- ç§»é™¤æ‰‹åŠ¨é™åˆ¶é€»è¾‘ï¼ˆdeque è‡ªåŠ¨å¤„ç†ï¼‰

**ä¿®æ”¹å‰**:

```python
self.state_history: List[StateTransition] = []
# æ¯æ¬¡æ·»åŠ åæ‰‹åŠ¨æ£€æŸ¥å¹¶æˆªæ–­
max_history = max(self.max_transitions * 2, 50)
if len(self.state_history) > max_history:
    self.state_history = self.state_history[-max_history:]
```

**ä¿®æ”¹å**:

```python
from collections import deque
self._max_history_size = 50
self.state_history: deque = deque(maxlen=self._max_history_size)
# deque è‡ªåŠ¨å¤„ç†æº¢å‡ºï¼Œæ— éœ€æ‰‹åŠ¨é™åˆ¶
```

---

## ä¸‰ã€å¾…å¤„ç†çš„é—®é¢˜

### ğŸŸ¡ P0-3: æ ¹ç›®å½•å­˜åœ¨é‡å¤çš„æ¨¡å—æ–‡ä»¶

**çŠ¶æ€**: å¾…å¤„ç†

**ä½ç½®**: `src/` æ ¹ç›®å½•ä¸‹å­˜åœ¨ä¸å­æ¨¡å—é‡å¤çš„æ–‡ä»¶

```
src/account_manager.py      â† ä¸ src/account/manager.py é‡å¤
src/anti_ban_module.py      â† ä¸ src/browser/anti_ban_module.py é‡å¤
src/browser_simulator.py    â† ä¸ src/browser/simulator.py é‡å¤
src/config_manager.py       â† ä¸ src/infrastructure/config_manager.py é‡å¤
src/cookie_handler.py       â† ä¸ src/ui/cookie_handler.py é‡å¤
src/error_handler.py        â† ä¸ src/infrastructure/error_handler.py é‡å¤
src/logger.py               â† ä¸ src/infrastructure/logger.py é‡å¤
src/notificator.py          â† ä¸ src/infrastructure/notificator.py é‡å¤
src/points_detector.py      â† ä¸ src/account/points_detector.py é‡å¤
src/scheduler.py            â† ä¸ src/infrastructure/scheduler.py é‡å¤
src/search_engine.py        â† ä¸ src/search/search_engine_legacy.py é‡å¤
src/search_term_generator.py â† ä¸ src/search/search_term_generator.py é‡å¤
src/state_monitor.py        â† ä¸ src/infrastructure/state_monitor.py é‡å¤
```

**ä¾èµ–åˆ†æ**:

- éƒ¨åˆ†æµ‹è¯•æ–‡ä»¶ä¾èµ– `src/` æ ¹ç›®å½•ä¸‹çš„æ¨¡å—
- éœ€è¦å…ˆæ›´æ–°æµ‹è¯•å¯¼å…¥è·¯å¾„ï¼Œå†åˆ é™¤é‡å¤æ–‡ä»¶

**å»ºè®®**:

1. æ›´æ–°æµ‹è¯•æ–‡ä»¶çš„å¯¼å…¥è·¯å¾„
2. åˆ é™¤ `src/` æ ¹ç›®å½•ä¸‹çš„é‡å¤æ–‡ä»¶
3. ä¿ç•™å­ç›®å½•ä¸­çš„æ¨¡å—åŒ–ç‰ˆæœ¬

---

### ï¿½ P1-2: ä¾èµ–æ³¨å…¥å®¹å™¨æœªè¢«ä½¿ç”¨

**çŠ¶æ€**: ä½ä¼˜å…ˆçº§ï¼Œæš‚ä¸å¤„ç†

**ä½ç½®**: `src/infrastructure/container.py`

**è¯´æ˜**: å½“å‰æ‰‹åŠ¨ä¾èµ–æ³¨å…¥å·¥ä½œæ­£å¸¸ï¼Œå®¹å™¨ä»£ç å¯ä½œä¸ºæœªæ¥æ‰©å±•ä¿ç•™

---

### ğŸŸ¢ P1-3: å¥åº·ç›‘æ§èµ„æºæ¶ˆè€—

**çŠ¶æ€**: ä½ä¼˜å…ˆçº§ï¼Œæš‚ä¸å¤„ç†

**ä½ç½®**: `src/infrastructure/health_monitor.py`

**å»ºè®®**: æœªæ¥å¯è€ƒè™‘å¤ç”¨ HTTP ä¼šè¯

---

### ğŸŸ¢ P2 ç³»åˆ—é—®é¢˜

- P2-1: æ—¥å¿—çº§åˆ«ä¸ä¸€è‡´
- P2-2: ç±»å‹æ³¨è§£ä¸å®Œæ•´
- P2-3: æµ‹è¯•è¦†ç›–ç‡ä¸è¶³

**çŠ¶æ€**: é•¿æœŸæ”¹è¿›é¡¹

---

## å››ã€æ¶æ„åˆ†æ

### 4.1 ä¼˜ç‚¹

1. **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†ï¼ˆaccount, browser, search, tasks, loginï¼‰
2. **ä¾èµ–æ³¨å…¥**: æ”¯æŒä¾èµ–æ³¨å…¥ï¼Œæé«˜å¯æµ‹è¯•æ€§
3. **çŠ¶æ€æœºæ¨¡å¼**: ç™»å½•æµç¨‹ä½¿ç”¨çŠ¶æ€æœºï¼Œé€»è¾‘æ¸…æ™°
4. **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å™¨ï¼Œæ”¯æŒé‡è¯•å’Œåˆ†ç±»
5. **å¥åº·ç›‘æ§**: å®Œå–„çš„ç³»ç»Ÿå¥åº·ç›‘æ§æœºåˆ¶
6. **é…ç½®ç®¡ç†**: æ”¯æŒå¼€å‘æ¨¡å¼è¦†ç›–ï¼Œé…ç½®éªŒè¯

### 4.2 æ”¹è¿›å»ºè®®

1. **æ¸…ç†å†—ä½™ä»£ç **: ~~åˆ é™¤å¤‡ä»½ç›®å½•~~ âœ… å’Œé‡å¤æ–‡ä»¶
2. **ç»Ÿä¸€ä¾èµ–ç®¡ç†**: ä½¿ç”¨å®¹å™¨æˆ–æ‰‹åŠ¨æ³¨å…¥ï¼ŒäºŒé€‰ä¸€
3. **å®Œå–„æµ‹è¯•**: å¢åŠ æµ‹è¯•è¦†ç›–ç‡

---

## äº”ã€ä¼˜åŒ–æ‰§è¡Œè®°å½•

| æ—¥æœŸ | é—®é¢˜ | çŠ¶æ€ | å¤‡æ³¨ |
|------|------|------|------|
| 2026-02-14 | P0-2 å†—ä½™å¤‡ä»½ç›®å½• | âœ… å·²å®Œæˆ | åˆ é™¤ 3 ä¸ªå¤‡ä»½ç›®å½• |
| 2026-02-14 | P1-1 é…ç½®éªŒè¯é€»è¾‘ | âœ… å·²å®Œæˆ | æ”¯æŒä¸¤ç§ wait_interval æ ¼å¼ |
| 2026-02-14 | P1-4 çŠ¶æ€æœºå†…å­˜ç®¡ç† | âœ… å·²å®Œæˆ | ä½¿ç”¨ deque æ›¿ä»£ list |
| - | P0-3 é‡å¤æ¨¡å—æ–‡ä»¶ | ğŸŸ¡ å¾…å¤„ç† | éœ€æ›´æ–°æµ‹è¯•å¯¼å…¥è·¯å¾„ |

---

## å…­ã€é¡¹ç›®å¥åº·åº¦è¯„åˆ† (æ›´æ–°å)

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| ä»£ç ç»„ç»‡ | â­â­â­â­â­ | æ¨¡å—åŒ–è‰¯å¥½ï¼Œå·²æ¸…ç†å†—ä½™å¤‡ä»½ |
| å®‰å…¨æ€§ | â­â­â­ | æœ¬åœ°å¼€å‘é˜¶æ®µï¼Œæ•æ„Ÿæ–‡ä»¶å·² gitignore |
| å¯ç»´æŠ¤æ€§ | â­â­â­â­ | æ¶æ„æ¸…æ™°ï¼Œæ–‡æ¡£å®Œå–„ |
| æ€§èƒ½ | â­â­â­â­ | å¼‚æ­¥è®¾è®¡ï¼Œèµ„æºç®¡ç†è‰¯å¥½ |
| æµ‹è¯•è¦†ç›– | â­â­â­ | æœ‰æµ‹è¯•ä½†è¦†ç›–ä¸å…¨ |

---

*æŠ¥å‘Šæ›´æ–°å®Œæ¯•*
