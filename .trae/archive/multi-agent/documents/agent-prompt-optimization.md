# Agent 提示词优化计划

## 问题诊断

### 问题 1：docs-agent 缺失物理边界约束
- docs-agent 需要移动/删除文档文件
- 当前提示词完全没有提及文件操作规范

### 问题 2：提示词过于啰嗦
当前 dev-agent.md 提示词统计：
- 物理环境前置检查：约 15 行（表格 + 协议）
- 权限隔离约束：4 条
- 执行序列：4 步
- 状态标签输出规则：表格
- 禁止猜测原则：3 条
- 上下文阻塞协议：3 条
- 局部验证命令：4 行

**总计约 40+ 行**，严重违反"减轻上下文注入"原则。

### 问题 3：禁忌太多（心理学问题）
- 当前大量使用"**绝对禁止**"、"**严禁**"
- 心理学研究表明：负面指令（"不要想大象"）反而会激活相关概念
- 应该用正向指令（"要做什么"）替代负面指令

## 优化策略

### 核心原则：正向指令 + 精简下沉

1. **正向指令优先**：告诉 Agent "要做什么"，而不是"不能做什么"
2. **关键约束保留**：环境安全约束是硬性要求，但用正向表述
3. **详细规则下沉**：将具体操作规范移到 Skill，提示词只保留骨架

### 精简后的提示词结构

```markdown
# Identity
<一句话身份定义>

# Protocol
## 文件操作
- 移动/重命名 → `Move-Item`
- 删除 → `Remove-Item`  
- 依赖缺失 → `[BLOCK_NEED_MASTER]`

## 执行序列
1. 读取 `.trae/current_task.md`
2. 阅读 `.trae/skills/<skill-name>/SKILL.md`
3. 执行任务
4. 输出状态标签

## 状态流转
<精简的状态标签表格>
```

**目标：每个 Agent 提示词控制在 20 行以内**

## 变更清单

### MODIFIED: dev-agent.md 提示词
- 移除"绝对禁止"表述，改为正向指令
- 精简物理边界约束为 3 条核心规则
- 移除"禁止猜测原则"、"上下文阻塞协议"（下沉到 Skill）
- 保留执行序列和状态流转

### MODIFIED: test-agent.md 提示词
- 同样精简物理边界约束
- 移除"强制反推演机制"、"标准化阻断协议"、"覆写策略"、"精简取证规范"、"截图落盘规范"（全部下沉到 Skill）
- 提示词只保留骨架

### MODIFIED: docs-agent.md 提示词
- 添加物理边界约束（与 dev-agent 一致）
- 精简执行序列
- 移除冗余约束

### MODIFIED: dev-execution/SKILL.md
- 接收从提示词下沉的内容
- 保留详细的操作规范

### MODIFIED: test-execution/SKILL.md
- 接收从提示词下沉的内容
- 已有二维错误诊断矩阵，保持不变

### MODIFIED: docs-execution/SKILL.md
- 接收从提示词下沉的内容
- 添加文件操作规范

## 预期效果

| Agent | 当前行数 | 优化后行数 | 减少 |
|-------|---------|-----------|------|
| dev-agent | ~40 行 | ~15 行 | 62% |
| test-agent | ~50 行 | ~15 行 | 70% |
| docs-agent | ~20 行 | ~15 行 | 25% |

## 风险评估

- **低风险**：详细规则下沉到 Skill，Agent 仍然会在执行时阅读
- **正向指令优势**：减少认知负荷，提高执行准确率
