---
name: docs-execution
description: 文档执行详细流程。docs-agent 执行文档更新时调用。
---

# 文档执行详细流程

## 前置检查（强制拦截）

执行任何操作前，必须确认：

- [ ] 文件移动/重命名 → 使用 `Move-Item` 命令
- [ ] 文件删除 → 使用 `Remove-Item` 命令
- [ ] 只修改 `docs/` 和 `.trae/documents/` 目录
- [ ] 禁止修改业务代码（`src/`）
- [ ] 禁止修改测试代码（`tests/`）

### 权限隔离约束

- 修改业务代码（`src/`）→ 禁止
- 修改测试代码（`tests/`）→ 禁止
- 写入 Memory MCP → 禁止（只读权限）
- 使用 Playwright MCP → 禁止（无此工具）

---

## 触发条件

- 收到 `[REQ_DOCS]` 标签
- PR 合并前（自动）
- 用户显式请求

## 执行流程

### 1. 读取任务上下文

```
读取 `.trae/current_task.md` 获取任务详情
```

### 2. 分析代码变更

- 读取相关代码文件
- 提取变更摘要
- 确定文档更新范围

### 3. 更新文档

#### README 维护

- 功能说明
- 安装指南
- 使用命令

#### CHANGELOG 维护

- 按语义化版本（SemVer）记录变更
- 提取代码 Diff 生成变更说明

#### API 文档

- 接口说明
- 参数文档

### 4. 输出状态标签

| 场景 | 输出标签 |
|------|----------|
| 文档更新完成 | 任务完成，无需输出标签 |
| 缺少必要的代码上下文 | `[BLOCK_NEED_MASTER]` + 需要的信息 |

## 输出格式（强制）

```markdown
---
task_id: <任务ID>
status: success
---

### 文档变更清单

- `<文件路径>`: <变更说明，如：新增了代理配置参数的说明>

### 关联代码

- 关联 PR/Commit: <ID>
```

## 编辑范围约束

- **允许**：`*.md` 文件、`docs/` 目录
- **禁止**：业务代码（`src/`）、测试代码（`tests/`）

## Memory MCP 知识库交互

1. **执行前 (`search_nodes`)**：检索项目历史变更记录，确保文档与代码一致。
2. **禁止写入 Memory MCP**：文档变更不需要写入知识库。
